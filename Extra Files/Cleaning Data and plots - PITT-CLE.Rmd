---
title: "Data Cleaning"
author: "Jack Mrray"
date: "1/30/2022"
output: html_document
---
----------------
Library and data reading in
----------------
```{r library}
library(tidyverse)
library(lubridate)
```

----------------
Functions to Clean the data
----------------
->Only includes SOD reports - daily weather reports
```{r data cleaning}
Only_SOD <- function(FucntionDAta)
{
Daily_Data <- FucntionDAta %>%
  mutate(time = hms(substr(FucntionDAta$DATE,12,19))) %>%
  mutate(Date = ymd(substr(FucntionDAta$DATE,1,11))) %>%
  filter(time == hms("23:59:00")) 
#all SOD reports are releases at 23:59:00

Redcuced_Daily_Data <- Daily_Data %>%
  select(Date,STATION,REPORT_TYPE,starts_with("Dai"),ends_with("ude"))
#only select column that include the daily weather (w/ some date and location data too)


#Remove Duplicate dates
j<-1
removerow <- 0

for (i in 2:(nrow(Redcuced_Daily_Data)))
{
    if(Redcuced_Daily_Data$Date[i] == Redcuced_Daily_Data$Date[i-1])
    {
        removerow[j] <- i
        j<-j+1
    }else
    {
      #print("OK")
    }
}

Good_SOD_Data2 <- Redcuced_Daily_Data[-removerow,]
Good_SOD_Data <- Good_SOD_Data2 %>%
  drop_na(DailyAverageWindSpeed)
return(Good_SOD_Data)
  }
```

----------------
Data read in 
================
From NOAA
```{r read in data}
Cle_Data <- read.csv("C:/Users/jackm/Desktop/Data Science/Project/CLE data 2.1.2012 - 1.28.2022.csv")
Pitt_Data <- read.csv("C:/Users/jackm/Desktop/Data Science/Project/PITT data 2.1.2012 - 1.28.2022.csv")
```
Only Daily SOD reports
```{r}
CLE_SOD_Data <- Only_SOD(Cle_Data)
PITT_SOD_Data <- Only_SOD(Pitt_Data)
All_SOD_DAta <- rbind(CLE_SOD_Data,PITT_SOD_Data)
```
Station Names
```{r stations}
names <- data.frame(
  STATION = c(72524014820,72520094823),
  NAME = c("CLE","PITT"))

All_SOD_WNames <- All_SOD_DAta %>%
  inner_join(names, by = "STATION" )
```

--------------------
#WInds Data Visualizations
====================
```{r plot some data}
ggplot(All_SOD_WNames,aes(DailyAverageWindSpeed))+
  geom_histogram(binwidth = 5, color = "Black", alpha = .7)+
  facet_grid(rows = vars(NAME))+
  labs(x = "WindSpeed",
       title = "Histogram of Wind Speed")
```
Wind speed - like other solar - seems to have a gamma like distribution 
  * few values around days with No wind
  * the bulk of days are between 5-10 days 
  * heavily positively skewed 
```{r}
All_SOD_WNames %>%
  mutate(Day = yday(Date))%>%
  group_by(Day,NAME)%>%
  summarise(mean_wind = mean(DailyAverageWindSpeed))%>%
ggplot(aes(Day,mean_wind,color = NAME))+
   geom_point()+
   geom_smooth(se = FALSE)+
   labs(x = "days in year",
        y = "average wind speed",
        title = "Wind speed over the year (CLE - PITT)")
```
Winter months tend to be windier than summer months - wind farms could counter act the heavier cloud cover and precipitation in these months. 
However, these wind farms will supply less power in the summer. 
```{r}
All_SOD_WNames%>%
  select(Date,NAME,DailyAverageWindSpeed)%>%
  pivot_wider(
    names_from = NAME,
    values_from = DailyAverageWindSpeed)%>%
ggplot(aes(CLE,PITT))+
  geom_bin2d()+
  geom_density2d()+
  labs(x = "CLE Wind Speed",
       y = "PITT Wind Speed",
       title = "PITT vs CLE Wind Speed")
```
Cleveland is winder than Pittsburgh - this could be cased by its proximity to the great lakes. Possible that we should favor places to the coast line when researching places with eh best wind speed. 

------------------
#other wether data
------------------
Need to turn the T (Trace) to a numeric measure 
    *Trace means less then .01 inches of precipitation with some accumulation
```{r precipitation}
for (j in 1:nrow(All_SOD_WNames))
{
  if(All_SOD_WNames$DailySnowfall[j] == "T" || All_SOD_WNames$DailySnowfall[j] == "" || All_SOD_WNames$DailySnowfall[j] == "Ts")
  {
    All_SOD_WNames$DailySnowfall[j] = .005
  }
  if(All_SOD_WNames$DailyPrecipitation[j] == "T" || All_SOD_WNames$DailyPrecipitation[j] == "" || All_SOD_WNames$DailyPrecipitation[j] == "Ts")
  {
    All_SOD_WNames$DailyPrecipitation[j] = .005
  }
  if(All_SOD_WNames$DailySnowDepth[j] == "T")
  {
    All_SOD_WNames$DailySnowDepth[j] = 0
  }
    #all snow less than .01 inches is assumed to melt or blow off solar panels
}

All_SOD_WNames_Rain <- All_SOD_WNames %>%
  mutate(snow = as.numeric(DailySnowfall),
         rain = as.numeric(DailyPrecipitation),
         TotPrecip = (snow+rain))
```

Visualize the Precipitation
```{r}
All_SOD_WNames_Rain %>%
  group_by(wk = week(Date),
           NAME)%>%
  summarise(meanPrecip = mean(TotPrecip))%>%
  ggplot(aes(wk,meanPrecip, color = NAME))+
  geom_point()+
  geom_smooth(se = FALSE)+
  labs(x = "Weeks",
       y = "Total Precipitation (in)",
       title = "Average Precipitation Throughout the Year")
  
```
Since their is more rain/snow in the winter months in the rust belt - it is logical to assume more wind farms are needed to support this region in the winter 

#possible predictors
--------------------
1) latitude
2) longitude
3) time of year
4) the year
  *maybe there is a upward/downward trend in radiation or wind speed due to global warming or something
5) pressure
  *low pressure predicts bad weather
      - high winds
      - heavier cloud cover
  *high pressure predicts good weather
      - low winds
      - less clouds
  *maybe compounded with time of year but maybe places with constant pressure have more consistent renewable production 
6) precipitation 
  *more precipitation means less solar production
7) snow depth 
  *more snow on the ground the less solar production
  *more work and maintenance costs
8) wild fires and smog (air quality)
9) is it coastal city
  *EX: Cleveland may have more wind prediction because its on Lake Erie
10) Cloud Cover