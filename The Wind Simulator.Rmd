---
title: "The Simulator"
author: "Jack Murray"
date: "3/21/2022"
output: html_document
---

```{r library}
library(ggplot2)
library(tidyverse)
library(lubridate)
library(caret)
library(MASS)
```

```{r read in}
daily.ave <- read.csv("Daily Averages per Location")
```

## Preproceces the data a bit
  + Only fit 1 location for now
    + 1020062
  + Convert date in to days since the first observation 
```{r onelocal}
orgin_Date <- (as.Date(daily.ave$DATE[1]))

location1 <- daily.ave %>%
  filter(Locations ==1020062)%>%
  mutate(total.days = day(days(as.Date(DATE)-orgin_Date)),
         log.daily_wimd = log(daily_Wind))
```

## fitting parameters
 $$
  A\times(\cos(\frac{\pi*days}{182.5})+
  A\times(\cos(\frac{\pi*days}{91.25})+
  A\times(\cos(\frac{\pi*days}{45.625})+
  A\times(\sin(\frac{\pi*days}{182.5})+
  A\times(\sin(\frac{\pi*days}{91.25})+
  A\times(\cos(\frac{\pi*days}{45.625})+
  C
  $$ 
```{r}
#cross validation 
#folds <- createFolds(location1$daily_Wind, 
#                     k = 5, 
#                     returnTrain = TRUE)
#ctrl <- trainControl(method = "cv",
#                     index = folds)

#traing for loop
A <- 2
A2 <- 2
C <- 2
A3 <- 2
A4 <- 2
i <- 0
w<-1
q<-1
size <- 4*4*4*4*4*4*5

values<-seq(from =1, to=(size), by=1)

rmse.error.wind.tot <-data.frame(A=values,A2=values,A3=values,A4=values,A5=values,A6=values,C=values,RMSE=values)
pred.sin.days <- seq(1,nrow(location1))

for(A in seq(from=.1,to=.4,by=.1))
{
  for(A2 in seq(from=.1,to=.4,by=.1))
  {
    for(C in seq(from = -1, to = 1, by=.5))
    {
      for(A3 in seq(from=.1,to=.4,by=.1))
      {
        for(A4 in seq(from=.1,to=.4,by=.1))
        {
          for(A5 in seq(from=.1,to=.4,by=.1))
          {
            for(A6 in seq(from=.1,to=.4,by=.1))
            {
              rse.error.wind <-0
              rmse.error.wind <-0
      
            for(i in seq(from=1,to=nrow(location1),by=1))
            {
              pred.sin.days[i] <- ((A2*cos((pi*location1$total.days[i])/91.25))+
                                  (A*cos((pi*location1$total.days[i])/182.5))+
                                  (A3*sin((pi*location1$total.days[i])/182.5))+
                                  (A4*sin((pi*location1$total.days[i])/91.25))+
                                  (A5*sin((pi*location1$total.days[i])/45.625))+
                                  (A6*cos((pi*location1$total.days[i])/45.625))+
                                  C)
              rse.error.wind <- rse.error.wind + ((pred.sin.days[i]-location1$log.daily_wimd[i])^2)
            } # loop of all obs.
            rmse.error.wind <- sqrt(rse.error.wind/nrow(location1))
            
            rmse.error.wind.tot$A[w] <- A
            rmse.error.wind.tot$A2[w] <- A2
            rmse.error.wind.tot$A3[w] <- A3
            rmse.error.wind.tot$A4[w] <- A4
            rmse.error.wind.tot$A5[w] <- A5
            rmse.error.wind.tot$A6[w] <- A6
            rmse.error.wind.tot$C[w] <- C
            rmse.error.wind.tot$RMSE[w] <- rmse.error.wind
            w<-w+1
            } # lop A6
          } #loop of A5
        } #loop of A4
      } # loop of A3
 # q<-q+1
    } # Loop of C
  } # loop of A2
  if (nrow(rmse.error.wind.tot)==size)
  {
    break
  }

} #loop of A
```

## Selecting the best parameters
```{r}
#rmse.error.wind.tot %>%
#  ggplot(aes(x=b,y=RMSE,color=C))+
#  geom_smooth(se=FALSE)

best.rmse.wind <- rmse.error.wind.tot %>%
  filter(RMSE==min(rmse.error.wind.tot$RMSE))
best.rmse.wind 
```

## Visualize the fittied equation
  + may need to filter down the number of days to see the sinusoidal motion
```{r}
fitted1<-location1 %>%
  mutate(sin.days = (best.rmse.wind$A*cos((pi*location1$total.days)/182.5))+
                    (best.rmse.wind$A2*cos((pi*location1$total.days)/91.25))+
                    (best.rmse.wind$A3*sin((pi*location1$total.days)/182.5))+
                    (best.rmse.wind$A4*sin((pi*location1$total.days)/91.25))+
                    (best.rmse.wind$A5*sin((pi*location1$total.days)/45.625))+
                    (best.rmse.wind$A6*sin((pi*location1$total.days)/45.625))+
                    best.rmse.wind$C)

fitted1 %>%
  filter(total.days>3000,
         total.days<4000)%>%
  ggplot()+
  geom_line(aes(y = sin.days, x = total.days),se=FALSE,color="red")+
  geom_point(aes(total.days,log.daily_wimd),alpha = .2)
```

## Distibution of errors
```{r}
error <- fitted1%>%
  mutate(errors = daily_Wind-sin.days)

fit <- fitdistr(error$errors, densfun="normal") 
fit
fit$loglik

error %>%
  ggplot(aes(errors))+
  geom_histogram(bins=20,alpha=.4,fill="blue",color="black")

```
  + Errors are mostly normal around 0. However, there seems to be some negative skewing and the peak is not on 0. Indicating there are more values that are overestimate of the wind speed than underestimates. 